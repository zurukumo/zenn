---
title: "NestJSã§Rakeã‚¿ã‚¹ã‚¯ã¿ãŸã„ãªã“ã¨ã‚’ã—ãŸã„"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["NestJS", "ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼"]
published: true
published_at: "2024-04-11 23:50"
publication_name: "ukiyocreate_dev"
---

## æ¦‚è¦
NestJSã§Railsã®Rakeã‚¿ã‚¹ã‚¯ã®ã‚ˆã†ãªã“ã¨ã‚’ã—ãŸã„ã¨æ€ã£ãŸã®ã§ã€ãã®æ–¹æ³•ã‚’èª¿ã¹ã¦ã¿ãŸã€‚
[NestJSã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.nestjs.com/recipes/nest-commander)ã§ã¯main.tsã«Nest-Commanderã‚’çµ„ã¿è¾¼ã‚€æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ãŒã€ãã‚Œã‚’ã™ã‚‹ã¨ã‚¿ã‚¹ã‚¯å®Ÿè¡Œå°‚ç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€main.tsã«ã¯Webã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ã®æ©Ÿèƒ½ã‚’æœãŸã—ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰ã€åŒæ™‚ã«ä»–ã®å ´æ‰€ã§ã‚¿ã‚¹ã‚¯ã‚‚ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚

## çŠ¶æ³ãƒ»ç›®æ¨™è¨­å®š
### çŠ¶æ³
Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦BooksControllerã‚„BooksServiceãŒç¨¼åƒã—ã¦ã„ã‚‹ã¨ã™ã‚‹ã€‚

### ç›®æ¨™
Nest-Commanderã‚’ä½¿ã£ã¦ã€BooksServiceã‚’åˆ©ç”¨ã—ã¦ã‚‹ã‚¿ã‚¹ã‚¯ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

### ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
ç¨¼åƒä¸­ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨ã™ã‚‹ã€‚
```typescript:app.module.ts
import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { BooksModule } from './books/books.module';

@Module({
  imports: [BooksModule],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

```typescript:books/books.module.ts
import { Module } from '@nestjs/common';
import { BooksController } from './books.controller';
import { BooksService } from './books.service';

@Module({
  controllers: [BooksController],
  providers: [BooksService],
})
export class BooksModule {}
```

```typescript:books/books.controller.ts
import { Controller, Get } from '@nestjs/common';
import { BooksService } from './books.service';

@Controller('books')
export class BooksController {
  constructor(private readonly booksService: BooksService) {}

  @Get()
  findAll() {
    return this.booksService.getBooks();
  }
}
```

```typescript:books/books.service.ts
import { Injectable } from '@nestjs/common';

@Injectable()
export class BooksService {
  getBooks() {
    return [
      { id: 1, title: 'Book 1', author: 'Alice' },
      { id: 2, title: 'Book 2', author: 'Bob' },
      { id: 3, title: 'Book 3', author: 'Carol' },
    ];
  }
}
```

`localhost:3000/books`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹ã“ã¨ã‚‚ç¢ºèªã§ãã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/0aba7c776176-20240411.png)

## æµã‚Œ
### 1. Nest-Commanderã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[Nest-Commanderã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nest-commander.jaymcdoniel.dev/en/introduction/installation/)ã«å¾“ã„ã€Nest-Commanderã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
```bash
npm i nest-commander
```

### 2. Tasks Moduleã‚’ä½œæˆ
ã‚¿ã‚¹ã‚¯ã‚’ã¾ã¨ã‚ã‚‹ãŸã‚ã®TasksModuleã‚’ä½œæˆã™ã‚‹ã€‚
```bash
nest g module tasks
```
:::message
`nest g`ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨ã€`app.module.ts`ãŒè‡ªå‹•ã§æ›¸ãæ›ã‚ã‚Šã€TasksModuleãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚ãŸã ã—ã€AppModuleã§TasksModuleã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯ãªã„ã®ã§ã€å‰Šé™¤ã™ã‚‹ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã€‚
:::

ã‚¿ã‚¹ã‚¯ã§ã¯BooksServiceã‚’åˆ©ç”¨ã™ã‚‹äºˆå®šãªã®ã§ã€TasksModuleå†…ã§BooksModuleã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãŠãã€‚ã¾ãŸã€BooksModuleä»¥å¤–ã®Moduleã§ã‚‚BooksServiceã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã€BooksModuleã§BooksServiceã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ãŠãã€‚
```typescript:tasks/tasks.module.ts
import { Module } from '@nestjs/common';

import { BooksModule } from 'src/books/books.module';

@Module({
  imports: [BooksModule],
})
export class TasksModule {}
```

```typescript:books/books.module.ts
import { Module } from '@nestjs/common';
import { BooksController } from './books.controller';
import { BooksService } from './books.service';

@Module({
  controllers: [BooksController],
  providers: [BooksService],
  exports: [BooksService],
})
export class BooksModule {}
```

### 3. é©å½“ã«ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
ä»Šå›ã¯getBooksã®çµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹ã€‚
Nest-Commanderã¯ç‹¬è‡ªã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚„ã‚¯ãƒ©ã‚¹ã‚’æŒã¤ã®ã§ã€`nest g`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦é››å½¢ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã‚Šã€ä¸€ã‹ã‚‰æ‰‹å‹•ã§ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ãŸã»ã†ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã¨ã„ã†å°è±¡ã€‚ä»Šå›ã¯ã‚¿ã‚¹ã‚¯ã ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«task.tsã§ãƒ•ã‚¡ã‚¤ãƒ«åãŒçµ‚ã‚ã‚‹ã‚ˆã†ã«ã—ãŸã€‚
```typescript:tasks/console-books.task.ts
import { Command, CommandRunner } from 'nest-commander';
import { BooksService } from 'src/books/books.service';

@Command({ name: 'console-books', description: 'getBooksã®ä¸­èº«ã‚’å‡ºåŠ›' })
export class ConsoleBooksCommand extends CommandRunner {
  constructor(private readonly booksService: BooksService) {
    super();
  }

  async run(): Promise<void> {
    console.log(this.booksService.getBooks());
  }
}
```
`@Command({ name: 'console-books', description: 'getBooksã®ä¸­èº«ã‚’å‡ºåŠ›' })`ã®nameã®éƒ¨åˆ†ãŒã‚¿ã‚¹ã‚¯ã®åå‰ã«ãªã‚‹ã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’å‘¼ã³å‡ºã™ã¨ãã‚‚ã“ã®åå‰ã‚’åˆ©ç”¨ã™ã‚‹ã€‚
ä¾å­˜æ³¨å…¥ã¯NestJSã®ã‚µãƒ¼ãƒ“ã‚¹ã¨åŒæ§˜ã«constructorã§è¡Œã†ã€‚ãŸã ã—ã€é€šå¸¸ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ç•°ãªã‚Šconstructorã®ä¸­ã§`super`ã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹ã€‚
å®Ÿéš›ã®ã‚¿ã‚¹ã‚¯ã®å‡¦ç†å†…å®¹ã¯`run`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã«è¨˜è¿°ã™ã‚‹ã€‚

ãã®ä»–ã«ã‚‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’å–ã‚‹æ©Ÿèƒ½ãªã©ãŒã‚ã‚‹ã€‚è©³ã—ãã¯[Nest-Commanderã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nest-commander.jaymcdoniel.dev/en/introduction/intro/)ã‚’å‚ç…§ã€‚

### 4. TasksModuleã«ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²
```typescript:tasks/tasks.module.ts
import { Module } from '@nestjs/common';

import { BooksModule } from 'src/books/books.module';
import { ConsoleBooksCommand } from './console-books.task';

@Module({
  imports: [BooksModule],
  providers: [ConsoleBooksCommand],
})
export class TasksModule {}
```

### 5. cli.tsã‚’ä½œæˆã™ã‚‹
main.tsã¨åŒã˜éšå±¤ã«cli.tsã‚’ä½œæˆã™ã‚‹ã€‚
Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯main.tsã‚’èµ·ç‚¹ã«ã€ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¯cli.tsã‚’èµ·ç‚¹ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚
```typescript:cli.ts
import { CommandFactory } from 'nest-commander';

import { TasksModule } from './tasks/tasks.module';

async function bootstrap() {
  await CommandFactory.run(TasksModule, ['log', 'debug', 'warn', 'error']);
}

bootstrap();
```

`['log', 'debug', 'warn', 'error']`ã®éƒ¨åˆ†ã¯ãƒ­ã‚°ã®å‡ºåŠ›ãƒ¬ãƒ™ãƒ«ã®è¨­å®šãªã®ã§ãŠå¥½ã¿ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€‚

### 6. ãƒ“ãƒ«ãƒ‰ã—ã¦ã€ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
```bash
npm run build && node dist/cli.js console-books
```

```bash:å‡ºåŠ›çµæœ
[Nest] 95301  - 04/11/2024, 11:33:04 PM     LOG [NestFactory] Starting Nest application...
[Nest] 95301  - 04/11/2024, 11:33:04 PM     LOG [InstanceLoader] CommandRootModule dependencies initialized +8ms
[Nest] 95301  - 04/11/2024, 11:33:04 PM     LOG [InstanceLoader] BooksModule dependencies initialized +0ms
[Nest] 95301  - 04/11/2024, 11:33:04 PM     LOG [InstanceLoader] DiscoveryModule dependencies initialized +0ms
[Nest] 95301  - 04/11/2024, 11:33:04 PM     LOG [InstanceLoader] TasksModule dependencies initialized +0ms
[Nest] 95301  - 04/11/2024, 11:33:04 PM     LOG [InstanceLoader] CommandRunnerModule dependencies initialized +0ms
[
  { id: 1, title: 'Book 1', author: 'Alice' },
  { id: 2, title: 'Book 2', author: 'Bob' },
  { id: 3, title: 'Book 3', author: 'Carol' }
]
```

å®Ÿè¡Œã§ãã¾ã—ãŸã€‚ã‚ã§ãŸã—ã€‚

## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
https://github.com/mshinji/nest-commander-practice
